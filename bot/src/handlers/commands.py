"""Telegram command handlers."""
import logging

from aiogram import Router
from aiogram.filters import Command, CommandStart
from aiogram.types import Message

from bot.src.utils.memory import get_memory

logger = logging.getLogger(__name__)

router = Router(name="commands")


@router.message(CommandStart())
async def cmd_start(message: Message) -> None:
    """Handle /start command."""
    await message.answer(
        "üî¨ Deep Research Bot\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å, –∏ —è –ø—Ä–æ–≤–µ–¥—É –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ "
        "—Å –ø–æ–∏—Å–∫–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç.\n\n"
        "üí° –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:\n"
        "‚Ä¢ –ö–∞–∫–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ –æ–±–ª–∞—Å—Ç–∏ –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤?\n"
        "‚Ä¢ –°—Ä–∞–≤–Ω–∏ —ç–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ Tesla –∏ BYD\n"
        "‚Ä¢ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ Python 3.13?\n\n"
        "üìù –ë–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ - –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã!\n\n"
        "‚å®Ô∏è –ö–æ–º–∞–Ω–¥—ã:\n"
        "/new - –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é (–æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é)\n"
        "/help - –°–ø—Ä–∞–≤–∫–∞"
    )


@router.message(Command("new"))
async def cmd_new(message: Message) -> None:
    """Handle /new command - start new session."""
    user_id = message.from_user.id if message.from_user else 0
    memory = get_memory()
    cleared = memory.clear_conversation(user_id)

    if cleared:
        await message.answer(
            "üÜï –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è –Ω–∞—á–∞—Ç–∞!\n\n"
            "–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ—á–∏—â–µ–Ω–∞. –ú–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å."
        )
    else:
        await message.answer(
            "üÜï –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è –Ω–∞—á–∞—Ç–∞!\n\n"
            "–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å."
        )


@router.message(Command("help"))
async def cmd_help(message: Message) -> None:
    """Handle /help command."""
    await message.answer(
        "üî¨ Deep Research Bot - —Å–ø—Ä–∞–≤–∫–∞\n\n"
        "–≠—Ç–æ—Ç –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AI-–∞–≥–µ–Ω—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ–±-–ø–æ–∏—Å–∫–∞ "
        "–¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≥–ª—É–±–æ–∫–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –ø–æ –≤–∞—à–∏–º –≤–æ–ø—Ä–æ—Å–∞–º.\n\n"
        "üìã –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:\n"
        "1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É\n"
        "2. –ë–æ—Ç –Ω–∞—á–Ω—ë—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (–æ–±—ã—á–Ω–æ 30-60 —Å–µ–∫—É–Ω–¥)\n"
        "3. –í—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏\n"
        "4. –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏\n\n"
        "üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:\n"
        "‚Ä¢ –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ Tavily\n"
        "‚Ä¢ –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n"
        "‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —Ü–∏—Ç–∞—Ç–∞–º–∏\n"
        "‚Ä¢ –ü–∞–º—è—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ - –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã\n\n"
        "‚å®Ô∏è –ö–æ–º–∞–Ω–¥—ã:\n"
        "/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É\n"
        "/new - –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é (–æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é)\n"
        "/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
        "/cancel - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å"
    )


@router.message(Command("cancel"))
async def cmd_cancel(message: Message) -> None:
    """Handle /cancel command."""
    # Note: Actual cancellation is handled in messages.py via user_locks
    await message.answer(
        "–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–º–µ–Ω—ã –ø–æ–ª—É—á–µ–Ω–∞.\n"
        "–ï—Å–ª–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –µ—â—ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –æ–Ω–æ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ."
    )
